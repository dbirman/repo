---
title: "effects_pkg"
author: "Dan Birman"
date: "Tuesday, October 28, 2014"
output: html_document
---

Load relevant packages

```{r}
library(ggplot2)
library(effects)
```

Generate a linear regression for an interaction

```{r}
m1 = lm(price ~ carat*cut,data=diamonds)
summary(m1)
```

Note that we have a ton of contrast coefficients because cut has 5 levels

```{r}
e1 = effect("carat",m1)
plot(e1)
```

```{r}
e2 = effect("cut",m1)
plot(e2)
```

What if we want to know the effect of cut at the extreme range of carat?

```{r}
e_c1 = effect("cut",mod=m1,given.values=c("carat"=0))
e_ct = effect("cut",mod=m1,typical="median")
e_cm = effect("cut",mod=m1,given.values=c("carat"=median(diamonds$carat)))
plot(e_c1)
plot(e_ct)
plot(e_cm)
```

Note that we could have multiple regressor variables and specify specific values for each of them using something like given.values=c("X"=1,"Y"=2), etc.

```{r}
ie = effect("carat*cut",m1)
# Note that carat is being binned
print(ie)
```

```{r}
plot(ie,multiline=T)
```

Note that the binned data for carat is actually an extrapolation from the histogram that's shown below.

We can also use ggplot to draw this graph.

```{r}
ed = data.frame(ie)
ie2 = effect("carat",m1)
ed2 = data.frame(ie2)
ggplot() + 
  geom_histogram(aes(ie$data$carat),binwidth=.05) +
  geom_point(data=ed,aes(carat,fit,color=cut),shape="X",size=4) + 
  geom_smooth(data=ed,aes(carat,fit,group=cut,color=cut,ymin=lower,ymax=upper),stat="identity") +
  theme_classic() +
  theme(legend.position=c(.15,.7)) +
  ylab("Price") +
  xlab("Carat")
```

### Higher Order Interactions

Let's use a new dataset (Prestige) which is included somewhere in the packages we loaded so far. Note that prof = professionals, wc = white collar, bc = blue blue collar

```{r}
pmod <- lm(prestige ~ log(income) + education + type, data=Prestige)
```

What if we just want to know what each of the main effects actually looks like? Maybe one of them is non-linear and we didn't know?

```{r}
plot(allEffects(pmod))
```

We might try to investigate the type effect a bit more. Maybe it's an interaction! Who knows?!!?

```{r}
pmod_i = lm(prestige ~ income*type,data=Prestige)
typ_eff = effect("income*type", pmod_i,
                 xlevels=list(income = quantile(Prestige$income, c(.1,.5,.9))))
plot(typ_eff,x.var="type")
```

We can also look at this with income on the x-axis, to compare it to the lm() output.

```{r}
plot(typ_eff)
summary(pmod_i)
```

And as we can see, the effect is much larger for type: professional than type: white collar when compared with the type: blue collar group.



Hope that was helpful!